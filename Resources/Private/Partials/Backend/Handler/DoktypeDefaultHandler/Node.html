{namespace tvp=Tvp\TemplaVoilaPlus\ViewHelpers}
{namespace be=TYPO3\CMS\Backend\ViewHelpers}

<f:if condition="{node.raw.table} == sys_file">
    <f:then>
        <tvp:thumbnail src="{node.raw.entity.uid}" height="64" width="64" />
    </f:then>
    <f:else>
        <f:render section="TableNode" arguments="{_all}" />
    </f:else>
</f:if>


<f:section name="TableNode">
<div class="tvp-node sortableItem {f:if(condition: '{settings.configuration.is10orNewer}', then:'', else: 'panel panel-default')} card {node.rendering.stylingClasses}" id="item{node.rendering.md5}" data-record-table="{node.raw.table}" data-record-uid="{node.raw.entity.uid}" data-parent-pointer="{node.rendering.parentPointer}" {node.rendering.additionalRecordData -> f:format.raw()}>
    <a name="c{node.rendering.md5}{node.raw.entity.uid}"></a>
    <div class="card-header dragHandle">
        <f:render partial="Backend/Handler/DoktypeDefaultHandler/Node/TitleBar" arguments="{node: node}" />
        <f:if condition="{node.rendering.errorNoMapping}">
            <div class="bg-warning px-2 py-1">&nbsp;<em><core:icon identifier="status-dialog-error" /> <f:translate key="{settings.configuration.lllFile}:error.fce.noMapping" arguments="{0: node.rendering.countUsedOnPage}" /></em></div>
        </f:if>
        <f:if condition="!{node.rendering.belongsToCurrentPage}">
            <div class="bg-info px-2 py-1">&nbsp;<em><core:icon identifier="status-dialog-notification" /> <f:translate key="{settings.configuration.lllFile}:infoElementFromOtherPage" arguments="{0: node.raw.entity.uid, 1: node.raw.entity.pid}" /></em></div>
        </f:if>
        <f:if condition="{node.rendering.countUsedOnPage} > 1">
            <div class="bg-info px-2 py-1">&nbsp;<em><core:icon identifier="status-dialog-notification" /> <f:translate key="{settings.configuration.lllFile}:infoElementUsedMultipleTimes" arguments="{0: node.rendering.countUsedOnPage}" /></em></div>
        </f:if>
        <f:if condition="{node.rendering.description}">
            <div class="bg-info px-2 py-1">&nbsp;<em><core:icon identifier="status-dialog-notification" /> <f:format.nl2br>{node.rendering.description}</f:format.nl2br></em></div>
        </f:if>
        <f:comment>@TODO
            infoElementFromOtherPage => modTSconfig['properties']['disableReferencedElementNotification']
            warning_elementusedmorethanonce => modTSconfig['properties']['disableElementMoreThanOnceWarning']
            warning_containerInheritance ??
            warning_containerSeparate => modTSconfig['properties']['disableContainerElementLocalizationWarning']
        </f:comment>
    </div>
    <div class="{f:if(condition: '{settings.configuration.is10orNewer}', then:'', else: 'panel-body')} card-body">
        <div class="tvp-record-edit">
            <f:render partial="Backend/Handler/DoktypeDefaultHandler/Node/TypeInformation" arguments="{node: node}" />
        </div>
        <f:if condition="{f:count(subject: node.childNodes.sDEF)} > 0">
            <f:if condition="{node.rendering.beLayout}">
                <f:variable name="beLayout" value="{node.rendering.beLayout}" />
            </f:if>
            <f:render partial="Backend/Handler/DoktypeDefaultHandler/Node/Childs" arguments="{node: node, beLayout: beLayout}" />
        </f:if>
        <div class="tvp-record-edit">
            <f:render partial="Backend/Handler/DoktypeDefaultHandler/PreviewContent" arguments="{node: node}" />
        </div>

    </div>

    <f:if condition="{settings.configuration.moreThanOneLanguageShouldBeShown} && {node.raw.entity.sys_language_uid} != -1 && {node.raw.table} != pages">

        <div class="{f:if(condition: '{settings.configuration.is10orNewer}', then:'', else: 'panel-footer')} card-footer">
            <f:comment>@TODO $this->render_localizationInfoTable($contentTreeArr, $parentPointer, $parentDsMeta)</f:comment>
            <table border="0" cellpadding="0" cellspacing="1" width="100%" class="lrPadding tpm-localisation-info-table">
                <tr class="bgColor4-20">
                    <td>
                        <f:translate key="{settings.configuration.lllFile}:labelLocalizations"/>:
                    </td>
                </tr>
                <f:for each="{settings.configuration.allExistingPageLanguages}" as="language">
                    <f:if condition="{language.uid} > 0">
                        <tr class="tpm-language-row">
                            <f:if condition="{node.localization.{language.uid}}">
                                <f:then>
                                    <td class="tpm-language-info">
                                        <div class="tvp-node {f:if(condition: '{settings.configuration.is10orNewer}', then:'', else: 'panel panel-default')} card {node.localization.{language.uid}.rendering.stylingClasses}"
                                             id="item{node.localization.{language.uid}.rendering.md5}" data-record-table="{node.localization.{language.uid}.raw.table}" data-record-uid="{node.localization.{language.uid}.raw.entity.uid}"
                                             data-parent-pointer="{node.localization.{language.uid}.rendering.parentPointer}">
                                            <a name="c{node.localization.{language.uid}.rendering.md5}{node.localization.{language.uid}.raw.entity.uid}"></a>
                                            <div class="card-header">
                                                <f:render partial="Backend/Handler/DoktypeDefaultHandler/Node/TitleBar" arguments="{node: '{node.localization.{language.uid}}'}"/>

                                            </div>
                                            <div class="{f:if(condition: '{settings.configuration.is10orNewer}', then:'', else: 'panel-body')} card-body">
                                                <div class="tvp-record-edit">
                                                    <f:render partial="Backend/Handler/DoktypeDefaultHandler/Node/TypeInformation" arguments="{node: '{node.localization.{language.uid}}'}"/>
                                                </div>
                                                <div class="tvp-record-edit">
                                                    <f:render partial="Backend/Handler/DoktypeDefaultHandler/PreviewContent" arguments="{node: '{node.localization.{language.uid}}'}"/>
                                                </div>

                                            </div>
                                        </div>
                                    </td>
                                </f:then>
                                <f:else>
                                    <td class="tpm-language-info">
                                        <a href="{node.localizationActions.{language.uid}.actionUrl}">
                                            <button type="button" class="btn btn-default btn-sm tvp-clipboard-release">
                                                <f:if condition="{settings.configuration.is10orNewer}">
                                                    <f:then>
                                                        <core:icon identifier="actions-document-add" size="small" />
                                                    </f:then>
                                                    <f:else>
                                                        <core:icon identifier="actions-document-new" size="small" />
                                                    </f:else>
                                                </f:if>
                                                <span title="{settings.configuration.allAvailableLanguages.{language.uid}.title}">
                                                    <core:icon identifier="{settings.configuration.allAvailableLanguages.{language.uid}.flagIcon}"/>
                                                 </span>
                                            <f:translate key="{settings.configuration.lllFile}:createCopyForTranslation"/>
                                            {settings.configuration.allAvailableLanguages.{language.uid}.title} ({settings.configuration.allAvailableLanguages.{language.uid}.ISOcode})

                                            </button>
                                        </a>
                                    </td>
                                </f:else>
                            </f:if>
                        </tr>
                    </f:if>
                </f:for>
            </table>
        </div>
    </f:if>

</div>
</f:section>
